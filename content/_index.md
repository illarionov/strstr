---
title: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º
description: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ
bookToc: true
bookFlatSection: false
date: 2022-05-24T09:32:31+03:00
draft: false
type: docs
math: true
aliases: [
  "/docs/twoway/"
]
weight: 1
---

# –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º

**–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º** (–∞–Ω–≥–ª. *Two-Way String-Matching algorithm*) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞
–ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –ú–∞–∫—Å–∏–º–æ–º –ö—Ä–æ—á–µ–º–æ—Ä–æ–º (Maxime Crochemore)
–∏ –î–æ–º–∏–Ω–∏–∫–æ–º –ü–µ—Ä—Ä–µ–Ω–æ–º (Dominique Perrin) –≤ 1991 –≥–æ–¥—É.[[2]](#reference_twoway_string_matching)
–û—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏,
–∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–º –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ (constant-space string matching).

–ü–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ *Text* –¥–ª–∏–Ω—ã *n* –∏ —à–∞–±–ª–æ–Ω—É –ø–æ–∏—Å–∫–∞ *Pattern* –¥–ª–∏–Ω—ã *m* –∞–ª–≥–æ—Ä–∏—Ç–º
–ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è *Pattern* –≤ *Text* –∑–∞ –≤—Ä–µ–º—è ${O(n+m)}$, –≥–¥–µ ${O(m)}$ ‚Äî —ç—Ç–∞–ø
–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞–¥ —à–∞–±–ª–æ–Ω–æ–º, –∞ ${O(n)}$ ‚Äî —ç—Ç–∞–ø –ø–æ–∏—Å–∫–∞. –ü—Ä–∏ —ç—Ç–æ–º, –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ ${2n-m}$ –æ–ø–µ—Ä–∞—Ü–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä–∏—Å–∞-–ü—Ä–∞—Ç—Ç–∞ –∏ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞, –¥–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ç—Ä–µ–±—É–µ—Ç
${O(\log(m))}$ –ø–∞–º—è—Ç–∏: –Ω–∞ —ç—Ç–∞–ø–µ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∞ —à–∞–±–ª–æ–Ω–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 2 –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –∏
—Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏—è —ç—Ç–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è. –ß–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—å—à–µ –¥–ª–∏–Ω—ã
—à–∞–±–ª–æ–Ω–∞ $m$, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ –ø–∞–º—è—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫
${\lceil\log_2m\rceil}$ –±–∏—Ç –∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∑—è—Ç–æ –∑–∞ ${O(1)}$.

–î—Ä—É–≥–æ–µ –æ—Ç–ª–∏—á–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –µ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π
–∞–ª—Ñ–∞–≤–∏—Ç, —Ç–∞–∫ –∫–∞–∫ –≤–æ –≤—Ä–µ–º—è –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞ —Å–∏–º–≤–æ–ª—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –Ω–∞ –±–æ–ª—å—à–µ –∏ –º–µ–Ω—å—à–µ.

–ê–ª–≥–æ—Ä–∏—Ç–º –≤ —Ü–µ–ª–æ–º —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–æ–º—É, —á—Ç–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ —à–∞–±–ª–æ–Ω–∞, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö —Ñ—É–Ω–∫—Ü–∏–π
`strstr()`, `memem()` –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫ libc: [glibc], [newlib] [musl] –ø—Ä–∏
–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ —à–∞–±–ª–æ–Ω–∞.

## –û–±—â–∞—è —Å—Ö–µ–º–∞

–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ–∏—Å–∫–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤
–ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ, –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä–∏—Å–∞-–ü—Ä–∞—Ç—Ç–∞ –∏ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞.

–í –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä–∏—Å–∞-–ü—Ä–∞—Ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤
—à–∞–±–ª–æ–Ω–∞ —Å —Å–∏–º–≤–æ–ª–∞–º–∏ —Ç–µ–∫—Å—Ç–∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ. –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
–≤ –∫–∞–∫–æ–π-—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ —à–∞–±–ª–æ–Ω–∞ (–ª–∏–±–æ –≤—Å–µ —Å–∏–º–≤–æ–ª—ã —à–∞–±–ª–æ–Ω–∞ —Ä–∞–≤–Ω—ã –∏ –Ω–∞–π–¥–µ–Ω–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ), —à–∞–±–ª–æ–Ω
—Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –ø–æ –∑–∞—Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ —Å–¥–≤–∏–≥–æ–≤ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
–ø–æ–∏—Å–∫–∞.

```goat
          .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                        
          | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

          .-----------------------------------------------------------------------------------.
    Text: | A   B   C       A   B   C   D   A   B       A   B   C   D   A   B   C   D   A   B |
          '-----------------------------------------------------------------------------------'
                             —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            ‚úî   ‚úî   ‚úî   ‚úò   --------------->
           .--------------------------.
Pattern‚ÇÅ: | A   B   C   D   A   B   D  |
           '+-------------------------'
            |
            |           ‚úò
            | –°–¥–≤–∏–≥    .--------------------------.
Pattern‚ÇÇ:   '-------->| A   B   C   D   A   B   D  |
                       +--------------------------'

                            ‚úî   ‚úî   ‚úî   ‚úî   ‚úî   ‚úî   ‚úò
                           .--------------------------.
Pattern‚ÇÉ:                 | A   B   C   D   A   B   D  |
                           '--------------------------'


                          –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä–∏—Å–∞-–ü—Ä–∞—Ç—Ç–∞
```

–í –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞ —Å—Ç—Ä–æ–∫–∞ —Ç–∞–∫–∂–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ, –Ω–æ —Å–∏–º–≤–æ–ª—ã —à–∞–±–ª–æ–Ω–∞
—Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ. –ü—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞, —à–∞–±–ª–æ–Ω —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞
—Å–º–µ—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ 2 —ç–≤—Ä–∏—Å—Ç–∏–∫–∞–º: –ø—Ä–∞–≤–∏–ª—É —Å–¥–≤–∏–≥–∞ –ø–ª–æ—Ö–æ–≥–æ
—Å–∏–º–≤–æ–ª–∞ –∏ –ø—Ä–∞–≤–∏–ª—É —Ö–æ—Ä–æ—à–µ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞.

```goat
          .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                        
          | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

          .-----------------------------------------------------------------------------------.
    Text: | A   B   A   B   C   X   F   D   E   D   E   A   X   A   A   B   C   D   E   B   C |
          '-----------------------------------------------------------------------------------'
                   —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                 <---------------   ‚úò   ‚úî   ‚úî
           .---------------------------------.
Pattern‚ÇÅ: | A   B   C   X   A   B   C   D   E |
           '+------------------------------+-'
            |
            |                                                           ‚úò
            |    –°–¥–≤–∏–≥                 .----------------------------------.
Pattern‚ÇÇ:   '------------------------>| A   B   C   X   A   B   C   D   E  |
                                       '+---------------------------------'

                                                                ‚úò   ‚úî   ‚úî   ‚úî   ‚úî   ‚úî
                                                   .----------------------------------.
Pattern‚ÇÉ:                                         | A   B   C   X   A   B   C   D   E  |
                                                   '+---------------------------------'

                           –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞
```

–í –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ —Å—Ç—Ä–æ–∫–∞ —à–∞–±–ª–æ–Ω–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 2 –ø–æ–¥—Å—Ç—Ä–æ–∫–∏: $u$ –∏ $v$. –°–Ω–∞—á–∞–ª–∞
—Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ $v$ —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ, –∑–∞—Ç–µ–º, –µ—Å–ª–∏ –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
—Å–æ–≤–ø–∞–ª–∏, —Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –ª–µ–≤–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ $u$ —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ. –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏–π
—Å–∏–º–≤–æ–ª, —Ç–æ —à–∞–±–ª–æ–Ω —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π. –ü—Ä–∞–≤–∏–ª–∞ —Å–¥–≤–∏–≥–æ–≤ –ø—Ä–∏
–Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Ä–∞–∑–Ω—ã–µ –¥–ª—è –ø—Ä–∞–≤–æ–π –∏ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è. –í–µ–ª–∏—á–∏–Ω–∞ —Å–¥–≤–∏–≥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∑–∞
–∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—É—é –ø–∞–º—è—Ç—å.

```goat
          .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                        
          | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

          .-----------------------------------------------------------------------------------.
    Text: | E   B   C   D   A   C   D   A   B   D   A   B   C   D   A   B   D   D   A   B   D |
          '-----------------------------------------------------------------------------------'

            2. –ª–µ–≤–∞—è    1. –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å
           <---------- ---------------->
                        ‚úî   ‚úî   ‚úò
           .--------------------------. 
Pattern‚ÇÅ: | A   B   C | D   A   B   D  +
           '+---------+---------------'
            |
            |               ‚úò   ‚úî   ‚úî   ‚úî   ‚úî   ‚úî
            | —Å–¥–≤–∏–≥    .--------------------------. 
Pattern‚ÇÇ:   '-------->| A   B   C | D   A   B   D  +
                       '+---------+---------------'

                                                        ‚úò
                                           .--------------------------. 
Pattern‚ÇÉ:                                 | A   B   C | D   A   B   D  +
                                           '+---------+---------------'


                       –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ
                      (—à–∞–±–ª–æ–Ω ABCDABD —Ä–∞–∑–±–∏—Ç –Ω–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ [ABC][DABD])
```

–û–±—â—É—é —Å—Ö–µ–º—É –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –ø—Å–µ–≤–¥–æ–∫–æ–¥–æ–º:
```kotlin
fun stringMatching(text, pattern): Boolean {
    val n = text.length
    val m = pattern.length
    val (u, v) = factorize(pattern)

    var pos = 0, i = u.length
    while (pos <= n-m) {
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
        while (i < m && pattern[i] == text[pos + i]) i += 1

        if (i == m) {
            // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
            if (text.substring(pos .. pos + u.lastIndex) == u) {
                return true
            }
        }
        (pos, i) = shift(pos, i)
    }
    return false
}
```

`factorize()` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –Ω–∞ 2 –ø–æ–¥—Å—Ç—Ä–æ–∫–∏.
–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–±–∏–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –Ω–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π *–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º
—Ä–∞–∑–±–∏–µ–Ω–∏–µ–º* (*Critical Factorization*) –∏ –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ *—Ç–µ–æ—Ä–µ–º–µ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —Ä–∞–∑–±–∏–µ–Ω–∏–∏*
(*Critical Factorization Theorem*).  
`shift()` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Å–¥–≤–∏–≥–æ–≤.
–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ ${x = uv}$, —Ç–∞–∫–æ–µ, —á—Ç–æ –¥–ª–∏–Ω–∞ –ª–µ–≤–æ–π
–ø–æ–¥—Å—Ç—Ä–æ–∫–∏ $u$ –º–µ–Ω—å—à–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ (${|u| < per(x)}$), –¥–ª–∏–Ω–∞ $u$
–º–∏–Ω–∏–º–∞–ª—å–Ω–∞, –∞ –ø—Ä–∞–≤–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ $v$ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–∞.

{{% hint %}}
–ï—Å—Ç—å —Ç–∞–∫–∂–µ –¥—Ä—É–≥–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º, –æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –∏
—Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø–æ —Ç–∞–∫–æ–π –∂–µ —Å—Ö–µ–º–µ ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –ì–∞–ª–∏–ª—è ‚Äî –°–µ–π—Ñ–µ—Ä–∞—Å–∞ (Galil - Seiferas)
[[1]](#reference_text_algorithms), [[4]](#reference_galil_seiferas). –í –Ω–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
—Ä–∞–∑–±–∏–µ–Ω–∏–µ, –Ω–∞–∑—ã–≤–∞–µ–º–æ–µ *–∏–¥–µ–∞–ª—å–Ω—ã–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º* (*perfect factorization*). –í—ã–±–∏—Ä–∞–µ—Ç—Å—è
–ø–æ–∑–∏—Ü–∏—è, –≥–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ —à–∞–±–ª–æ–Ω–∞.
{{% /hint %}}

## –ë–∞–∑–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

–ó–∞–¥–∞–¥–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –±–∞–∑–æ–≤—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –≤
–æ–ø–∏—Å–∞–Ω–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞.

__–ê–ª—Ñ–∞–≤–∏—Ç__

:   ***–ê–ª—Ñ–∞–≤–∏—Ç*** (*alphabet*) ‚Äî —ç—Ç–æ –∫–æ–Ω–µ—á–Ω–æ–µ –Ω–µ–ø—É—Å—Ç–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤. –û–±–æ–∑–Ω–∞—á–∏–º –µ–≥–æ —á–µ—Ä–µ–∑
$A$. –ü—Ä–∏–º–µ—Ä—ã –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞–ª—Ñ–∞–≤–∏—Ç–æ–≤:

    * ${A = \\\{\text{a,b,‚Ä¶, z}\\\}}$ ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ—á–Ω—ã—Ö –±—É–∫–≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞
    * ${A = \\\{\text{0,1,2,3,4,5,6,7,8,9}\\\}}$ ‚Äî  –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä
    * ${A = \\\{\text{0,1}\\\}}$: –±–∏–Ω–∞—Ä–Ω—ã–π –∞–ª—Ñ–∞–≤–∏—Ç

     –∏ —Ç.–ø.

__–°—Ç—Ä–æ–∫–∞__

:   ***–°—Ç—Ä–æ–∫–∞*** (***—Ç–µ–∫—Å—Ç***, ***—Å–ª–æ–≤–æ***) (*string*, *text*, *word*) ‚Äî –∫–æ–Ω–µ—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑
    –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ $A$. –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ ‚Äî —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
    –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ "${\tt{ABCDEF}}$" —Ä–∞–≤–Ω–∞ 6.

    –í–≤–µ–¥–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∫–∏ $x$:

    ${|x|}$ ¬≠‚Äî –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ $x$.  
    ${x[i]}$ ‚Äî ${(i+1)}$-—ã–π —Å–∏–º–≤–æ–ª —Å—Ç—Ä–æ–∫–∏ (—Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∏–Ω–¥–µ–∫—Å—É 0).  
    ${x[i‚Ä¶j]}$ ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ ${x[i]x[i+1]‚Ä¶x[j]}$ —Å—Ç—Ä–æ–∫–∏ $x$.

   –ü—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –æ–±–æ–∑–Ω–∞—á–∏–º —á–µ—Ä–µ–∑ $Œµ$. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –∞–ª—Ñ–∞–≤–∏—Ç–∞ $A$ ‚Äî
   —á–µ—Ä–µ–∑ ${A^{*}}$, –∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–µ—Ö –Ω–µ–ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ ‚Äî —á–µ—Ä–µ–∑ ${A^{+}}$.

__–ü–æ–¥—Å—Ç—Ä–æ–∫–∞__

:   –°—Ç—Ä–æ–∫–∞ $x$ –¥–ª–∏–Ω—ã $n$ —è–≤–ª—è–µ—Ç—Å—è ***–ø–æ–¥—Å—Ç—Ä–æ–∫–æ–π*** (–∏–ª–∏ ***—Ñ–∞–∫—Ç–æ—Ä–æ–º***) (*factor*,
    *subword*) —Å—Ç—Ä–æ–∫–∏ $y$, –µ—Å–ª–∏ ${x=y[i ‚Ä¶ i+n-1]}$ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ —Ü–µ–ª–æ–≥–æ $i$. –ú—ã –º–æ–∂–µ–º
    –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ $x$ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–µ $y$ –≤ –ø–æ–∑–∏—Ü–∏–∏ $i$. –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ
    –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ *–ø–æ–¥–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å*.  
    –°—Ç—Ä–æ–∫–∞ $x$ —è–≤–ª—è–µ—Ç—Å—è ***–ø–æ–¥–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é*** (*subsequence*) —Å—Ç—Ä–æ–∫–∏ $y$, –µ—Å–ª–∏ –æ–Ω–∞ –º–æ–∂–µ—Ç
    –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ–º –∏–∑ $y$ –Ω—É–ª—è –∏–ª–∏ –±–æ–ª–µ–µ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–∂–Ω—ã—Ö) —Å–∏–º–≤–æ–ª–æ–≤. –î—Ä—É–≥–∏–º–∏
    —Å–ª–æ–≤–∞–º–∏, –µ—Å–ª–∏ ${x=y[i‚ÇÅ]y[i‚ÇÇ]‚Ä¶y[i_m]}$, –≥–¥–µ ${i‚ÇÅ, i‚ÇÇ, i_m}$ ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∞—è—Å—è
    –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç—Ä–æ–∫–∏ $y$.

__–û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Å—Ç—Ä–æ–∫–∞–º–∏__

:    ***–ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π*** –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ $x$ –∏ $y$ –Ω–∞–∑—ã–≤–∞—é—Ç —Å—Ç—Ä–æ–∫—É —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å—å—é –∏—Ö
—Å–∏–º–≤–æ–ª–æ–≤. –û–±–æ–∑–Ω–∞—á–∏–º –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ $x$ –∏ $y$ –∫–∞–∫ $xy$. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏
${x=\texttt{AB}, y=\texttt{CD}}$, —Ç–æ ${xy=\tt{ABCD}}$.  
  –ß–µ—Ä–µ–∑ ${k^x}$ –æ–±–æ–∑–Ω–∞—á–∏–º –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é $k$ –∫–æ–ø–∏–π —Å—Ç—Ä–æ–∫–∏ $x$. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è ${x=\tt{AB}}$, 
  ${x‚Å¥=\tt{\underlinesegment{AB}\underlinesegment{AB}\underlinesegment{AB}\underlinesegment{AB}}}$.
  –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞, —Ç.–µ. ${(xy)z = x(yz)}$, –ø–æ—ç—Ç–æ–º—É —Å–∫–æ–±–∫–∏ –∑–¥–µ—Å—å –Ω–µ
  –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫ ${xyz}$.

  –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å—Ç—Ä–æ–∫—É ${x = uvw}$, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â—É—é –∏–∑ —Å–µ–±—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –∏–∑ 3 –ø–æ–¥—Å—Ç—Ä–æ–∫: $u$, $v$ –∏
  $w$. –ü–æ–¥—Å—Ç—Ä–æ–∫–∏ $u$, $v$ –∏ $w$ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è *—Ñ–∞–∫—Ç–æ—Ä–∞–º–∏*
  —Å—Ç—Ä–æ–∫–∏ $x$. –ö—Ä–æ–º–µ —Ç–æ–≥–æ:  
  $u$ ‚Äî —ç—Ç–æ *–ø—Ä–µ—Ñ–∏–∫—Å* —Å—Ç—Ä–æ–∫–∏ $x$,  
  $w$ ‚Äî —ç—Ç–æ *—Å—É—Ñ—Ñ–∏–∫—Å* —Å—Ç—Ä–æ–∫–∏ $x$.

__–ü—Ä–µ—Ñ–∏–∫—Å__

:   –°—Ç—Ä–æ–∫–∞ $u$ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ***–ø—Ä–µ—Ñ–∏–∫—Å–æ–º*** (*prefix*) —Å—Ç—Ä–æ–∫–∏ $x$, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∞—è —Å—Ç—Ä–æ–∫–∞ $v$, —á—Ç–æ
${x=uv}$. –ù–∞–ø—Ä–∏–º–µ—Ä, ${\tt ABC}$ ‚Äî —ç—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ ${\tt \underlinesegment{ABC}DAB}$.
    –ü—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏. –û–±—ã—á–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫
    –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π (Œµ), —Ç–∞–∫ –∏ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–æ–π.  
    ***–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å*** (*proper prefix*) ‚Äî —ç—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:
    –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–≤–µ–Ω –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ —Ü–µ–ª–∏–∫–æ–º.

__–°—É—Ñ—Ñ–∏–∫—Å__

:   –°—Ç—Ä–æ–∫–∞ $w$ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ***—Å—É—Ñ—Ñ–∏–∫—Å–æ–º*** (*suffix*) —Å—Ç—Ä–æ–∫–∏ $x$, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∞—è —Å—Ç—Ä–æ–∫–∞ $v$, —á—Ç–æ
    ${x=vw}$ –ù–∞–ø—Ä–∏–º–µ—Ä, ${\tt DAB}$ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ ${\tt ABC\underlinesegment{DAB}}$.
    –¢–∞–∫–∂–µ, –∫–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º, –æ–±—ã—á–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –ø—É—Å—Ç—ã–º, —Ç–∞–∫ –∏ –≤—Å–µ–π
    —Å—Ç—Ä–æ–∫–æ–π.  
    ***–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å*** (*proper suffix*) ‚Äî —ç—Ç–æ —Å—É—Ñ—Ñ–∏–∫—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å
    —Ä–∞–≤–µ–Ω –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–µ –∏ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ —Ü–µ–ª–∏–∫–æ–º.

__–ü–µ—Ä–∏–æ–¥__

:   ***–ü–µ—Ä–∏–æ–¥*** (*period*) —Å—Ç—Ä–æ–∫–∏ $x$ ‚Äî —ç—Ç–æ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ $p$, ${1<p‚â§|x|}$ —Ç–∞–∫–æ–µ, —á—Ç–æ
    ${‚àÄi‚àà\\{0,1,‚Ä¶|x|-p-1\\}x[i]=x[i+p]}$  
    –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, —ç—Ç–æ –¥–ª–∏–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Ç–µ–∫—Å—Ç–∞, –ø—Ä–∏—á–µ–º,
    –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å "–æ–±—Ä–µ–∑–∞–Ω–æ". –ù–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∫–∞ ${\tt{AABAAABAA}}$ (–µ—ë –¥–ª–∏–Ω–∞
    —Ä–∞–≤–Ω–∞ 9), –∏–º–µ–µ—Ç –ø–µ—Ä–∏–æ–¥—ã 4, 7, 8 –∏ 9:

    $\begin{aligned}
        & \tt{\large{\underbrace{AABA}_4\underbrace{AABA}\underbrace{A\phantom{ABA}}}} \\\\
        & \tt{\large{\underbrace{AABAAAB}_7\underbrace{AA\phantom{BAAAB}}}} \\\\
        & \tt{\large{\underbrace{AABAAABA}_8\underbrace{A\phantom{ABAAABA}}}} \\\\
        & \tt{\large{\underbrace{AABAAABAA}_9}}
      \end{aligned}$

   –û—Ç–º–µ—Ç–∏–º, —á—Ç–æ –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ –≤—Å–µ–≥–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –µ—ë –ø–µ—Ä–∏–æ–¥–æ–º, –∞ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–∏
   –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–µ—Ä–∏–æ–¥.  
   –û–±–æ–∑–Ω–∞—á–∏–º ***–Ω–∞–∏–º–µ–Ω—å—à–∏–π –ø–µ—Ä–∏–æ–¥*** —Å—Ç—Ä–æ–∫–∏ $x$ —á–µ—Ä–µ–∑ ${per(x)}$ (—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ), –∞ —Å–∞–º—É
   –ø–æ–¥—Å—Ç—Ä–æ–∫—É –Ω–∞–∏–º–µ–Ω—å—à–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî —á–µ—Ä–µ–∑ ${period(x)}$.

  –í–æ–∑—å–º–µ–º –Ω–µ–ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É $x$ –∏ –∫–∞–∫–æ–µ-—Ç–æ —á–∏—Å–ª–æ $p$ —Ç–∞–∫–æ–µ, —á—Ç–æ ${0<p‚â§|x|}$. –í–æ –≤—Å–µ—Ö —Å–ª–µ–¥—É—é—â–∏—Ö
—Å–ª—É—á–∞—è—Ö $p$ –±—É–¥–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–º —Å—Ç—Ä–æ–∫–∏ $x$:

   1) –ï—Å–ª–∏ $x$ ‚Äî —ç—Ç–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏ ${y^k}$, –≥–¥–µ ${|y|=p}$ –∏ ${k>0}$.  
      __–ü—Ä–∏–º–µ—Ä__  
      ${y^k=\underbrace{\texttt{ABC}}_y\underbrace{\tt{ABC}}_y\underbrace{\texttt{ABC}}_y\underbrace{\texttt{ABC}}_y}
        \qquad y=\texttt{ABC} \quad  {p=3} \quad {k=4} $  
      –ï—Å–ª–∏ –≤–∑—è—Ç—å –∑–∞ $x$ –ª—é–±–æ–π –ø—Ä–µ—Ñ–∏–∫—Å –∏–ª–∏ –ø–æ–¥—Å—Ç—Ä–æ–∫—É (—Ñ–∞–∫—Ç–æ—Ä) —Å—Ç—Ä–æ–∫–∏ ${y^k}$, —Ç–æ –æ–¥–∏–Ω –∏–∑ –µ—ë
      –ø–µ—Ä–∏–æ–¥–æ–≤ –±—É–¥–µ—Ç —Ç–æ–∂–µ 3.

   1) –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫—É $x$ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ ${(uv)^ku}$, –≥–¥–µ ${|uv|=p}$, —Å—Ç—Ä–æ–∫–∞ $v$ ‚Äî –Ω–µ–ø—É—Å—Ç–∞—è –∏ ${k>0}$  
     __–ü—Ä–∏–º–µ—Ä__  
     ${x = \underbrace{\texttt{ABC}}_u\underbrace{\texttt{DEFG}}_v\underbrace{\texttt{ABC}}_u\underbrace{\texttt{DEFG}}_v\underbrace{\texttt{ABC}}_u}$  
     ${u=\texttt{ABC}}, \space {v=\texttt{DEFG}}$  
     ${x=(uv)¬≤u}$  
     ${|uv|=7}, \space {p=7}$

   1) –í–æ–∑—å–º–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ $y$, $z$ —Ä–∞–≤–Ω–æ–π –¥–ª–∏–Ω—ã –∏ —Å—Ç—Ä–æ–∫—É $w$, —Ç–∞–∫–∏–µ, —á—Ç–æ
     ${x=yw=wz}$; ${|y|=|z|}$. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –¥–ª–∏–Ω–∞ $y$ –∏ $z$ –±—É–¥–µ—Ç –ø–µ—Ä–∏–æ–¥–æ–º —Å—Ç—Ä–æ–∫–∏
     $x$: ${|y|=|z|=p}$.  
     __–ü—Ä–∏–º–µ—Ä__  
      ${x=\mathrlap{
        \overbrace{\phantom{\mathtt{ABCDAB}}}^w
        \overbrace{\phantom{\mathtt{ABCD}}}^z
      } \underbrace{\mathtt{ABCD}}_y\underbrace{\mathtt{ABCDAB}}_w
      }$  
      ${y=\tt ABCD}$  
      ${z=\tt CDAB}$  
      ${w=\tt ABCDAB}$  
      ${p=|y|=|z|=4}$

__–ì—Ä–∞–Ω—å__

:   **–ì—Ä–∞–Ω—å** (—Ç–∞–∫–∂–µ **–≥—Ä–∞–Ω–∏—Ü–∞** –∏–ª–∏ **–±–æ—Ä–¥–µ—Ä**) (*border*) —Å—Ç—Ä–æ–∫–∏ $x$ ‚Äî —ç—Ç–æ –ª—é–±–æ–π
    —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–≤–µ–Ω –µ—ë —Å—É—Ñ—Ñ–∏–∫—Å—É. –¢.–µ. –≥—Ä–∞–Ω—å ‚Äî —ç—Ç–æ —Ç–∞–∫–∞—è —Å—Ç—Ä–æ–∫–∞
    $w$, —á—Ç–æ ${x=yw=wz}$.  –ì—Ä–∞–Ω—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–≤–Ω–∞ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ, –Ω–æ —Å—É—Ñ—Ñ–∏–∫—Å –∏ –ø—Ä–µ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏
    –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è.
    –ù–∞–ø—Ä–∏–º–µ—Ä, –≥—Ä–∞–Ω–∏ —Å—Ç—Ä–æ–∫–∏ ${\tt AABAAABAA}$: ${\tt AABAA, AA, A, Œµ}$.

    –û–±–æ–∑–Ω–∞—á–∏–º ***–Ω–∞–∏–±–æ–ª—å—à—É—é –≥—Ä–∞–Ω—å*** —Å—Ç—Ä–æ–∫–∏ $x$ —á–µ—Ä–µ–∑ ${Border(x)}$. –ú—ã –º–æ–∂–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–∞–∫—É—é –≥—Ä–∞–Ω—å
    –∫–∞–∫ –Ω–∞–∏–±–æ–ª—å—à–µ–µ —Å–æ–≤–ø–∞–¥–∞—é—â–µ–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ —Å–∞–º–æ–π –Ω–∞ —Å–µ–±—è.  
    –°—Ç—Ä–æ–∫–∞ $x$ ***—Å–≤–æ–±–æ–¥–Ω–∞ –æ—Ç –≥—Ä–∞–Ω–µ–π*** (*border free*), –µ—Å–ª–∏ –Ω–∞–∏–±–æ–ª—å—à–∞—è –≥—Ä–∞–Ω—å —Å—Ç—Ä–æ–∫–∏ ‚Äî —ç—Ç–æ –ø—É—Å—Ç–∞—è
    —Å—Ç—Ä–æ–∫–∞, –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –µ—Å–ª–∏ –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ø–µ—Ä–∏–æ–¥ —Ä–∞–≤–µ–Ω –¥–ª–∏–Ω–µ —Å—Ç—Ä–æ–∫–∏ (${per(x)=|x|}$)  
    –ú–µ–∂–¥—É –≥—Ä–∞–Ω—è–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏ –∏–º–µ–µ—Ç—Å—è –≤–∑–∞–∏–º–Ω–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, —ç—Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –ø–æ
    –ø—É–Ω–∫—Ç—É 3 –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞.

    ```goat
      .----------------+-------------------------------------.                                                         
    x |                |            –ì—Ä–∞–Ω—å x                  |
      '----------------+-------------------------------------+
        <------------> |                                     +
           –ü–µ—Ä–∏–æ–¥ x    +-------------------------------------+----------------.
                     x |            –ì—Ä–∞–Ω—å x                  |                |
                       '-------------------------------------+----------------'
    ```

## –û–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

–ü—É—Å—Ç—å $x$ ‚Äî –Ω–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –∞ ${uv}$ ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ $x$. –û–±–æ–∑–Ω–∞—á–∏–º —á–µ—Ä–µ–∑ $l$ –¥–ª–∏–Ω—É –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
—Ä–∞–∑–±–∏–µ–Ω–∏—è –º–∏–Ω—É—Å 1 (${l = |u| - 1}$). ${0‚â§l<|x|}$.  
–ù–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ $w$ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ***–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è $\textit{\textbf{uv}}$***
(*repetition for factorization*) –∏–ª–∏ ***–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –≤ –ø–æ–∑–∏—Ü–∏–∏ $\textit{\textbf{l}}$ —Å—Ç—Ä–æ–∫–∏
$\textit{\textbf{x}}$***, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–±–∞ —É—Å–ª–æ–≤–∏—è:

* $w$ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å $u$ –∏–ª–∏ $u$ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å $w$
* $w$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å $v$ –∏–ª–∏ $v$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å $w$

–ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è ($w$ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å $u$ –∏ $w$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å $v$) ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ä–∞–∑–±–∏–µ–Ω–∏–µ
–º–µ–∂–¥—É $u$ –∏ $v$ ‚Äî —ç—Ç–æ —Ü–µ–Ω—Ç—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ –≥–¥–µ-—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ $x$:

```goat
      .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                            
      | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

      .-------------------+---+-----------+---+---------------+--+-----------------------.
    x |                   |   |           |   |               |  |                       |
      '-------------------+---+-----------+---+---------------+--+-----------------------+
                          |l-r             l                  l+r|
                          |                                      |
                          .-------------------+------------------.
                          |         ùíò         |        ùíò         |
                          '-------------------+------------------'

        <------------------------------------> <---------------------------------------->
                         ùíñ                                         ùíó
```

–î—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∏—Ç—É–∞—Ü–∏—è–º, –∫–æ–≥–¥–∞ $l$ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–ª–∏–∑–∫–æ –∫ –∫—Ä–∞—è–º —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø—Ä–∏
–ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ $w$. –°—Ç–æ–∏—Ç –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ ${x=uv}$, –∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ $w$ –≤–∑—è—Ç—å
—Å—Ç—Ä–æ–∫—É $vu$, —Ç–æ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ $w$ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è $uv$ (–≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –æ–±–∞
—É—Å–ª–æ–≤–∏—è). –¢.–µ. –ª—é–±–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–µ–ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ $x$ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ.

–î–ª–∏–Ω–∞ $r$ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è $uv$ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ***–ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º
$\textit{\textbf{uv}}$*** –∏–ª–∏ ***–ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º —Å—Ç—Ä–æ–∫–∏ $\textit{\textbf{x}}$ –≤ –ø–æ–∑–∏—Ü–∏–∏
$\textit{\textbf{l}}$***.
–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —á–∏—Å–ª–æ $r$ —è–≤–ª—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º —Å—Ç—Ä–æ–∫–∏ $x$ –≤ –ø–æ–∑–∏—Ü–∏–∏ $l$, –µ—Å–ª–∏
${x[i]=x[i+r]}$ –¥–ª—è –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ ${l-r+1‚â§i‚â§l}$ –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–±–∞ —É—Å–ª–æ–≤–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.

***–ù–∞–∏–º–µ–Ω—å—à–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ*** –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è ${uv}$ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç—Å—è –∫–∞–∫
${r(u,v)}$.

__–ü—Ä–∏–º–µ—Ä—ã__

–ü—É—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ ${x=\texttt{ABAABAA}}$.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ –ø–æ–∑–∏—Ü–∏–∏ ${l=2}$:

${
  \gdef\string_idx#1{\color{aaaaaa} \tt #1}
  \mathrlap{
    \overbrace{\phantom{
       \def\arraystretch{1.3}\begin{array}{c c c} \string_idx{0} & \string_idx{1} & \tt 2 \\\\
        \tt A & \tt B & \tt A
       \end{array}
      }
      \hspace{0.4em}
    }^u
    \overbrace{\phantom{
       \def\arraystretch{1.3}\begin{array}{c c c} \string_idx{3} & \string_idx{4} & \string_idx{5}
       \\\\ A & B & A
       \end{array}
      }
      \hspace{1.3em}
    }^v
  } \def\arraystretch{1.3}\begin{array}{c:c:c|c:c:c:c} \tt
    \string_idx{0} & \string_idx{1} & \tt 2 & \string_idx{3} & \string_idx{4} & \string_idx{5} & \string_idx{6} \\\\ \hdashline
    \tt A & \tt B & \tt \underlinesegment{A} & \tt \underlinesegment{A} & \tt B & \tt A &
    \tt A
  \end{array}}
$

$r(\texttt{ABA}, \texttt{ABAA}) = |\texttt{A}| = 1$,  
–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ $w=\texttt{A}$.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ –ø–æ–∑–∏—Ü–∏–∏ ${l=1}$:

${
   \mathrlap{
   \underbrace{
    \hspace{1.05em}
    \phantom{
      \def\arraystretch{1.3}\begin{array}{c c}
        \string_idx{0} & 1 \\\\
            \tt A & \tt B
      \end{array}
    }
   }_w
   \underbrace{
    \phantom{
       \def\arraystretch{1.3}\begin{array}{c c c}
          \string_idx{2} \string_idx{3} \string_idx{4} \\\\
           \tt A & \tt A \tt B
          \end{array}
    }
   }_w
  } \hspace{1em}
    \def\arraystretch{1.3}\begin{array}{c:c|c:c:c:c:c}
      \string_idx{0} & 1 & \string_idx{2} & \string_idx{3} & \string_idx{4} &
      \string_idx{5} & \string_idx{6} \\\\
      \hdashline
      \tt A & \tt B & \tt A & \tt A & \tt B & \tt A & \tt A
    \end{array}
}$

${r(\texttt{AB}, \texttt{AABAA}) = |\texttt{AAB}| = 3}$,  
–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ${w=\texttt{AAB}}$.

–ü—É—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ ${x=\tt AABABAB}$

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ –ø–æ–∑–∏—Ü–∏–∏ ${l=5}$:

${ \mathrlap{
   \hphantom{
    \def\arraystretch{1.3}\begin{array}{c c c c}
      \string_idx{0} & \string_idx{1} & \string_idx{2} & \string_idx{3}
      \end{array}
   }
   \underbrace{
    \phantom{
      \def\arraystretch{1.3}\begin{array}{c c}
        \string_idx{4} \\\\
            \tt B & \tt \hspace{0.6em}
      \end{array}
    }
   }_w
   \underbrace{
    \phantom{
       \def\arraystretch{1.3}\begin{array}{c}
          \string_idx{6} \\\\
           \tt B
          \end{array}
       \hspace{0.6em}
    }
   }_w
  } \def\arraystretch{1.3}\begin{array}{c:c:c:c:c:c|c}
      \string_idx{0} & \string_idx{1} & \string_idx{2} & \string_idx{3} & \string_idx{4} &
      \texttt{5} & \string_idx{6} \\\\
      \hdashline
      \tt A & \tt A & \tt B & \tt A & \tt B & \tt A & \tt B
    \end{array}
}$

${r(\texttt{AABABA}, \texttt{B}) = |\texttt{BA}| = 2}$,  
–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ${w=\texttt{BA}}$.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–∑–∏—Ü–∏–∏ ${l=1}$:

${ \mathrlap{
   \underbrace{
    \phantom{
      \def\arraystretch{1.3}\begin{array}{c c c c c}
        \string_idx{3} \string_idx{2} \string_idx{1} \string_idx{0} 1 \\\\
            \tt B & \tt A & \tt B & \tt A & \tt A
      \end{array}
    }
   }_w
   \underbrace{
    \phantom{
       \def\arraystretch{1.3}\begin{array}{c c c c c}
          \string_idx{2} \string_idx{3} \string_idx{4} \string_idx{5} \string_idx{6}\\\\
           \tt B & \tt A & \tt B & \tt A & \tt B
          \end{array}
    }
   }_w
  } \hspace{6.6em}
    \def\arraystretch{1.3}\begin{array}{c:c|c:c:c:c:c}
      \string_idx{0} & 1 & \string_idx{2} & \string_idx{3} & \string_idx{4} &
      \string_idx{5} & \string_idx{6} \\\\
      \hdashline
      \tt A & \tt A & \tt B & \tt A & \tt B & \tt A & \tt B
    \end{array}
}$

${r(\texttt{AA}, \texttt{BABAB}) = |\tt BABABAA| = 7}$,  
–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ${w=\texttt{BABABAA}}$.

–ù–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ä–∞–∑–±–∏–µ–Ω–∏—è ${x=uv}$ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ
–ø–µ—Ä–∏–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏: ${1‚â§r(u,v)‚â§v}$, —ç—Ç–æ —Å–ª–µ–¥—É–µ—Ç –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π.

–†–∞–∑–±–∏–µ–Ω–∏–µ ${x=uv}$, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ä–∞–≤–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –ø–µ—Ä–∏–æ–¥—É –≤—Å–µ–π
—Å—Ç—Ä–æ–∫–∏ ${r(u,v)=per(x)}$ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ***–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º*** (*critical
factorization*), –∞ –ø–æ–∑–∏—Ü–∏—è ${l=|u|-1}$ ‚Äî ***–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∑–∏—Ü–∏–µ–π $\textit{\textbf{x}}$*** (*critical position*).

**–ü—Ä–∏–º–µ—Ä**

–ü—É—Å—Ç—å ${x=\tt \underlinesegment{AABABAB}AAB}$.  
–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å—Ç—Ä–æ–∫–∏ $x$: 7 (${\tt AABABAB}$)  
–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:

${\def\arraystretch{1.3}\begin{array}{r|c:c:c:c:c:c:c:c:c:c}
  \text{–°—Ç—Ä–æ–∫–∞} & \tt A & \tt A & \tt B & \tt A & \tt B & \tt A & \tt B & \tt A & \tt A
  & \tt B \\\\ \hdashline
  \text{–ü–æ–∑–∏—Ü–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è }l & 0 & 1 & 2 & 3 & 4 & 5 & 6 &
  7 & 8 & 9 \\\\ \hdashline
  \text{–õ–æ–∫. –ø–µ—Ä–∏–æ–¥ }r(u,v) & 1 & \underline{7} & 2 & 2 & 2 & 2 & \underline{7} & 1 & 3 & 1
\end{array}
}$

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–±–∏–µ–Ω–∏—è: ${(\texttt{AA}, \texttt{BABABAAB})}$ –∏ ${(\texttt{AABABAB}, \texttt{AAB})}$.

–í –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ, –ø—Ä–∏ —ç—Ç–æ–º –¥–ª–∏–Ω–∞ –ª–µ–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –º–µ–Ω—å—à–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤—Å–µ–π
—Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ (${|u| < per(pattern)}$).

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–¥–≤–∏–≥–æ–≤:

* –ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ –Ω–∞
  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–∑–∏—Ü–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–∞
  –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞:

  ```goat
            .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                      
            | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

            .-----------------------------------------------------------------------------------.
      Text: | E   B   C   D   A   C   D   A   B   D   A   B   C   D   A   B   D   D   A   B   D |
            '-----------------------------------------------------------------------------------'
                          –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å
                         ---------------->
                          ‚úî   ‚úî   ‚úò
             .-------------------------.
  Pattern‚ÇÅ: | A   B   C | D   A   B   D |
             '----------o--------------'
                         '---------.
                                    |
                         .----------v---------------.
  Pattern‚ÇÇ:             | A   B   C | D   A   B   D  |
                         '----------+---------------'
  ```

* –ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ª–µ–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–π
    –ø–µ—Ä–∏–æ–¥ —à–∞–±–ª–æ–Ω–∞ ${per(pattern)}$:

  ```goat
            .---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---.                      
            | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10 |11 |12 |13 |14 |15 |16 |17 |18 |19 |20 |

            .-----------------------------------------------------------------------------------.
      Text: | E   B   C   D   A   C   D   A   B   D   A   B   C   D   A   B   D   D   A   B   D |
            '-----------------------------------------------------------------------------------'

                          2. –ª–µ–≤–∞—è    1. –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å
                         <---------- ---------------->
                              ‚úò   ‚úî   ‚úî   ‚úî   ‚úî   ‚úî
                         .--------------------------.
  Pattern‚ÇÇ:             | A   B   C | D   A   B   D  |
                         +----------+---------------'
                         |
                         |
                         |                   .--------------------------.
  Pattern‚ÇÉ:               '---------------->| A   B   C | D   A   B   D  |
                          –°–¥–≤–∏–≥ –Ω–∞ per(x)=5  '----------+---------------'
                              —Å–∏–º–≤–æ–ª–æ–≤

  ```

–¢–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–¥–≤–∏–≥–æ–≤ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ. –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è
–∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–µ—Å–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ö—É–¥—à–µ–≥–æ —Å–ª—É—á–∞—è, –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞
–∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–∞ (*prefix memorization*): –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å–¥–≤–∏–≥ –Ω–∞ ${per(pattern)}$
–ø–æ –ø—Ä–∞–≤–∏–ª—É —Å–¥–≤–∏–≥–∞ –¥–ª—è –ª–µ–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å —Å–æ–≤–ø–∞–≤—à–µ–π —á–∞—Å—Ç–∏
—à–∞–±–ª–æ–Ω–∞, —á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –µ–≥–æ –µ—â—ë —Ä–∞–∑ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ.  
–≠—Ç–æ —Ç–∞ –∂–µ —Ç–µ—Ö–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
–ø—Ä–∞–≤–∏–ª–∞ –ì–∞–ª–∏–ª—è ([Wikipedia](https://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%91%D0%BE%D0%B9%D0%B5%D1%80%D0%B0_%E2%80%94_%D0%9C%D1%83%D1%80%D0%B0#cite_ref-_c27d75dd26585688_6-0)).

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞. –°—á–∏—Ç–∞–µ–º, —á—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥
—Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ ${per(pattern)}$ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ ${uv}$ —Å ${|u|<per(pattern)}$
–≤—ã—á–∏—Å–ª–µ–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ.

–ö–æ–¥ –Ω–∞ kotlin, –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã—Ö –ø–∞—Ä.

```kotlin
data class Factorization(val left: IntRange, val right: IntRange)

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –≤—Ö–æ–∂–¥–µ–Ω–∏–π —à–∞–±–ª–æ–Ω–∞ [pattern] –≤ —Å—Ç—Ä–æ–∫–µ [text]
 */
fun cp1(text: String, pattern: String): List<Int> {
    val result = mutableListOf<Int>()

    // factorize() —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —à–∞–±–ª–æ–Ω–∞ pattern –Ω–∞ 2 –ø–æ–¥—Å—Ç—Ä–æ–∫–∏:
    // left –∏ right —Ç–∞–∫, —á—Ç–æ |left| < period.
    // left, right - –∑–∞–∫—Ä—ã—Ç—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫
    // period - –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞
    val (left, right) = factorize(pattern)
    val period = pattern.getMinimalPeriod()

    var pos = 0
    var memPrefix = -1
    while (pos + pattern.length <= text.length) {
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
        val i = (maxOf(right.first, memPrefix + 1)..right.last).find{ i->
            pattern[i] != text[pos + i]
        }
        if (i != null) {
            pos = pos + i - right.first + 1
            memPrefix = -1
        } else {
            // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
            val match = (left.last downTo memPrefix + 1).all { j ->
                pattern[j] == text[pos + j]
            }
            if (match) result.add(pos)
            pos += period
            memPrefix = pattern.length - period - 1
        }
    }
    return result
}

```

`memprefix` ‚Äî –ø–æ–∑–∏—Ü–∏—è –∑–∞–ø–æ–º–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö
—Å–∏–º–≤–æ–ª–æ–≤. –ú–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ª–µ–≤–æ–π
–ø–æ–¥—Å—Ç—Ä–æ–∫–∏.

–õ–µ–º–º–∞

:   –ü—É—Å—Ç—å ${uv}$ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ $x$. –ï—Å–ª–∏ $w$ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å $u$ –∏ $w$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å
$v$ (–±–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π), —Ç–æ –¥–ª–∏–Ω–∞ $w$ –∫—Ä–∞—Ç–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –ø–µ—Ä–∏–æ–¥—É —Å—Ç—Ä–æ–∫–∏ $x$.

{{% details "–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ" %}}
–°–≤–æ–π—Å—Ç–≤–æ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —Ç–∞–∫ –∫–∞–∫
${r(u,v)=per(x)}$, —Ç.–µ. ${per(x)}$ —Ä–∞–≤–µ–Ω –ø–µ—Ä–∏–æ–¥—É —Å—Ç—Ä–æ–∫–∏ $w$, —Ç–æ $x$ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫
${(yz)^e}$, –≥–¥–µ ${|yz|=per(x)}$, $z$ ‚Äî –Ω–µ –ø—É—Å—Ç–∞—è, ${e>0}$. –ï—Å–ª–∏ $y$ –Ω–µ –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π, —Ç–æ
–æ–Ω–∞ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è ${uv}$. –ù–æ ${|y|<per(x)}$ –±—É–¥–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å —Ç–æ–º—É,
—á—Ç–æ ${uv}$ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ. –ü–æ—ç—Ç–æ–º—É, ${|w|=e*period(x)}$.

```goat
                                          period(x)                                                                    
                                         <--------->
   .------------+-----------+-----------+-----------+-----------+-----------+---------------.
   |            |  yz       |      yz   |      yz   |      yz   |      yz   |               |
   '------------+-----------+-----------+-----------+-----------+-----------+---------------'
                            |                       |                       |
                            |                       |                       |
   .------------------------+-----------------------+-----------------------+---------------.
   |                        |           ùíò           |           ùíò           |               |
   '------------------------+-----------------------+-----------------------+---------------'

```
{{% /details %}}

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –µ—Å—Ç—å –≤ [[1]](#reference_text_algorithms). –í —Ç–∞–∫–æ–º
–≤–∏–¥–µ –∞–ª–≥–æ—Ä–∏—Ç–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–∫—Å–∏–º—É–º ${2*|text|}$ –æ–ø–µ—Ä–∞—Ü–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è. (–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ç–∞–º –∂–µ).

–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –±–æ–ª—å—à–æ–π
(–º–µ–Ω—å—à–µ –ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—ã –¥–ª–∏–Ω—ã —à–∞–±–ª–æ–Ω–∞), –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –µ–≥–æ
–≤—ã—á–∏—Å–ª–µ–Ω–∏—è.

–í—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –ø–µ—Ä–∏–æ–¥–µ —Å—Ç—Ä–æ–∫–∏
—à–∞–±–ª–æ–Ω–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –µ–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–±–æ–ª—å—à–æ–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
—Å—Ä–∞–≤–Ω–µ–Ω–∏–π.

–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ —Ç–µ–º, —á—Ç–æ –≤ –Ω–µ–º –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞,
–∞ –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤ –ª–µ–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ ‚Äî —à–∞–±–ª–æ–Ω —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–µ –Ω–∞
${per(pattern)}$ –ø–æ–∑–∏—Ü–∏–π, –∞ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ $q$, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ
–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (${q ‚â§ per(pattern)}$).  
–ï—Å–ª–∏ –≤–∑—è—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è ${q=1}$, —Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∞–Ω–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω
–Ω–∞–∏–≤–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É —Å –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é, –ø–æ—ç—Ç–æ–º—É —á–∏—Å–ª–æ $q$ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å
–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º: ${q > \max(|u|, |v|)}$, –≥–¥–µ ${uv}$ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ
${pattern}$. –í —Ç–∞–∫–æ–º –≤–∏–¥–µ —á–∏—Å–ª–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –≤–æ –≤—Ç–æ—Ä–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –ø–æ –ø—Ä–µ–∂–Ω–µ–º—É –±—É–¥–µ—Ç
–º–µ–Ω—å—à–µ ${2*|text|}$, –∫–∞–∫ –∏ –≤ –ø–µ—Ä–≤–æ–º, –Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –Ω–µ
–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.  
–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ
$q$ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ ${per(pattern)}$.

```kotlin
fun twoWay2(text: String, pattern: String): List<Int> {
    val result = mutableListOf<Int>()

    val (left, right) = factorize(pattern)
    val q = maxOf(left.length, right.length) + 1

    var pos = 0
    while (pos + pattern.length <= text.length) {
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
        val i = right.find { i -> pattern[i] != text[pos + i] }
        if (i != null) {
            pos = pos + i - right.first + 1
        } else {
            // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
            val match = left.reversed().all { j -> pattern[j] == text[pos + j] }
            if (match) result.add(pos)
            pos += q
        }
    }
    return result
}
```

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤—É
–ø–µ—Ä–≤–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –≤ [[1]](#reference_text_algorithms).

–ö–æ–Ω–µ—á–Ω—ã–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞, –≤—ã–±–∏—Ä–∞—è –Ω—É–∂–Ω—ã–π –≤
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ª–µ–≤–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ —Å—É—Ñ—Ñ–∏–∫—Å–æ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∞–≤–æ–π. –í
–∞–ª–≥–æ—Ä–∏—Ç–º–µ, –∫—Ä–æ–º–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ –Ω–∞ ${u,v}$, –≥–¥–µ ${|u|<per(pattern)}$, —Ç–∞–∫–∂–µ
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ $v$. –ï–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç
–±—ã—Ç—å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ
—Ä–∞–∑–±–∏–µ–Ω–∏—è.

```kotlin
data class Factorization(
    val left: IntRange,
    val right: IntRange,
    val rightPeriod: Int
)

fun twoWay(text: String, pattern: String): List<Int> {
    // factorize() —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —à–∞–±–ª–æ–Ω–∞ pattern –Ω–∞ 2 –ø–æ–¥—Å—Ç—Ä–æ–∫–∏:
    // left –∏ right —Ç–∞–∫, —á—Ç–æ |left| < per(pattern) –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–µ—Ä–∏–æ–¥ –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏.
    // left, right ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫.
    // rightPeriod ‚Äî –ø–µ—Ä–∏–æ–¥ –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
    val (left, right, rightPeriod) = factorize(pattern)

    // left ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ right[0..rightPeriod-1]
    val leftIsSuffixOfRight = left.all { i ->
        pattern[i] == pattern[right.first + rightPeriod - left.length + i]
    }
    return if (leftIsSuffixOfRight) {
        // rightPeriod —Ä–∞–≤–µ–Ω –ø–µ—Ä–∏–æ–¥—É —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ per(pattern).
        // –í—ã–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∏—Å–ø–æ–ª—å–∑—É—è left, right
        // –∏ rightPeriod –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        cp1(text, pattern, left, right, rightPeriod)
    } else {
        // –í—ã–∑—ã–≤–∞–µ–º –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∏—Å–ø–æ–ª—å–∑—É—è left, right
        // –∏ q.
        val q = maxOf(left.length, right.length) + 1
        cp2(text, pattern, left, right, q)
    }
}
```

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∞ —Ç–∞–∫–∂–µ —Ç–æ–≥–æ, —á—Ç–æ ${q=max(|u|,|v|)+1}$ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç
—É—Å–ª–æ–≤–∏—é ${q‚â§per(pattern)}$ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ $u$ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—É—Ñ—Ñ–∏–∫—Å–æ–º ${v[0‚Ä¶p-1]}$, –¥–∞–Ω—ã –≤ [[1]](#reference_text_algorithms).

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞ –≤—Ä–µ–º—è ${O(|text| + |pattern|)}$ —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–π –ø–∞–º—è—Ç—å—é, –ø—Ä–∏ —ç—Ç–æ–º
–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ ${2*|text|}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.

–£—Å–ª–æ–≤–∏–µ "${u\texttt{ ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å }v[0‚Ä¶p-1]}$" –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –∑–∞ ${|pattern|/2}$
—Å—Ä–∞–≤–Ω–µ–Ω–∏–π, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è ‚Äî ${4*|pattern|}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É
–≤–µ—Å—å –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –∑–∞ ${4.5*|pattern|}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.

#### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

1\. –í–æ–∑—å–º–µ–º —à–∞–±–ª–æ–Ω ${pattern=\texttt{A}^n\texttt{B}}$. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ: ${(\texttt{A}^n,
\texttt{B})}$. –ü–æ–∏—Å–∫ –≤ —Ç–µ–∫—Å—Ç–µ ${\texttt{B}^m}$ –ø–æ—Ç—Ä–µ–±—É–µ—Ç ${2*|text|/|pattern|}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.
–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏, –∞–ª–≥–æ—Ä–∏—Ç–º —Å–¥–≤–∏–≥–∞–µ—Ç —à–∞–±–ª–æ–Ω –Ω–∞ 3 –ø–æ–∑–∏—Ü–∏–∏.
```goat
Text:      B B B B B B B B B B B B B B B B B B B B B B B                                                               

             ‚úò ‚úî
Pattern‚ÇÅ:  A A|B

                   ‚úò ‚úî
Pattern‚ÇÇ:        A A|B

                         ‚úò ‚úî
Pattern‚ÇÉ:              A A|B
```

2\. –®–∞–±–ª–æ–Ω ${pattern=\texttt{A}^n\texttt{BA}^n}$ —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º ${n+1}$. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ
—Ä–∞–∑–±–∏–µ–Ω–∏–µ: ${(\texttt{A}^n, \texttt{BA}^n)}$. –õ–µ–≤–∞—è —á–∞—Å—Ç—å ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏
–ø—Ä–∞–≤–æ–π, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ ${2*|text|-2e-2}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –ø—Ä–∏
–ø–æ–∏—Å–∫–µ –≤ —Ç–µ–∫—Å—Ç–µ ${text=(\texttt{A}^n\texttt{BA})^e\texttt{A}^{n-1}}$.
```goat
Text:     A A B A A A B A A A B A A A B A A A B A A A B A                                                              

          ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÅ: A A|B A A

                    ‚úò
Pattern‚ÇÇ:       A A|B A A

                  ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÉ:         A A|B A A

                            ‚úò
Pattern‚ÇÑ:               A A|B A A

                          ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÖ:                 A A|B A A
```

3\. –®–∞–±–ª–æ–Ω ${pattern=\texttt{A}^n\texttt{BA}^{n-1}}$. –ê–ª–≥–æ—Ä–∏—Ç–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π
–≤–∞—Ä–∏–∞–Ω—Ç –∏ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç ${2*|text|-2e-2}$ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –ø—Ä–∏
–ø–æ–∏—Å–∫–µ –≤ —Ç–µ–∫—Å—Ç–µ ${text=(\texttt{A}^n\texttt{BA})^e\texttt{A}^{n-1}}$.
```goat
Text:     A A A B A A A B A A A B A A A B A A A B A A A B                                                              

          ‚úî ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÅ: A A A|B A A

                  ‚úî ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÇ:         A A A|B A A

                          ‚úî ‚úî ‚úî ‚úî ‚úî ‚úî
Pattern‚ÇÉ:                 A A A|B A A
```

## –¢–µ–æ—Ä–µ–º–∞ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —Ä–∞–∑–±–∏–µ–Ω–∏–∏

–†–∞–±–æ—Ç–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö —Å—Ç—Ä–æ–∫–∏,
–æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –≤ **—Ç–µ–æ—Ä–µ–º–µ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —Ä–∞–∑–±–∏–µ–Ω–∏–∏** (*Critical Factorization Theorem*).

–¢–µ–æ—Ä–µ–º–∞ –≥–ª–∞—Å–∏—Ç, —á—Ç–æ –ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ $x$ –∏–º–µ–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ ${x=uv}$
(—Ç.–µ. —Ç–∞–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ, —á—Ç–æ ${r(u,v)=per(x)}$).  –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ $u$ –º–æ–∂–µ—Ç –±—ã—Ç—å
–≤—ã–±—Ä–∞–Ω–∞ —Ç–∞–∫–æ–π, —á—Ç–æ ${|u|<per(x)}$.

–í–ø–µ—Ä–≤—ã–µ –æ–Ω–∞ –±—ã–ª–∞ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –∏ –¥–æ–∫–∞–∑–∞–Ω–∞ –≤ —Ä–∞–±–æ—Ç–∞—Ö C√©sari –∏ Vincent –≤ 1978, –∞ –≤
—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤–∏–¥–µ ‚Äî –≤ —Ä–∞–±–æ—Ç–µ J. Duval (1989). –¢–µ–æ—Ä–µ–º–∞ –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤, –Ω–æ –¥–ª—è
–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –±—ã–ª–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ —Å–≤–æ–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ, –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤.

–í–≤–µ–¥–µ–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ —Å—Ç—Ä–æ–∫.

***–õ–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π*** (–∏–ª–∏ ***–∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π***) –ø–æ—Ä—è–¥–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫
${A^{*}}$ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ $A$. –î–ª—è –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ ${x, y ‚àà A^\*}$ —Å—Ç—Ä–æ–∫–∞ ${x‚â§y}$ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞
–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π:
* $x$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å $y$
* $x$ *—Å—Ç—Ä–æ–≥–æ –º–µ–Ω—å—à–µ* $y$. –¢. –µ. $x$ –∏ $y$ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫
${x=w\texttt{A}x, y=w\texttt{B}y}$, –≥–¥–µ ${w,x,y}$ ‚Äî —Å—Ç—Ä–æ–∫–∏  –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ ${A^{*}}$; –∞
${\texttt{A}, \texttt{B}}$ ¬≠‚Äî –¥–≤–∞ —Å–∏–º–≤–æ–ª–∞, —Ç–∞–∫–∏–µ, —á—Ç–æ ${\texttt{A}<\texttt{B}}$.

***–û–±—Ä–∞—Ç–Ω—ã–π –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫*** ‚Äî –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ –∞–ª—Ñ–∞–≤–∏—Ç–µ $A$,
–ø–æ—Ä—è–¥–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π. –¢.–µ. $x$ —Å—Ç—Ä–æ–≥–æ –º–µ–Ω—å—à–µ $y$, –µ—Å–ª–∏ $x$ –∏ $y$
–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ ${x=w\texttt{A}x, y=w\texttt{B}y}$, –≥–¥–µ ${w,x,y}$ ‚Äî —Å—Ç—Ä–æ–∫–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞
${A^{*}}$, –∞ ${\texttt{A}, \texttt{B}}$ ¬≠‚Äî –¥–≤–∞ —Å–∏–º–≤–æ–ª–∞, —Ç–∞–∫–∏–µ, —á—Ç–æ ${\texttt{A}>\texttt{B}}$.

–û–±–æ–∑–Ω–∞—á–∏–º —á–µ—Ä–µ–∑ $‚â§$ –ø—Ä—è–º–æ–π –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫, –∞ —á–µ—Ä–µ–∑ $‚™Ø$ ‚Äî –æ–±—Ä–∞—Ç–Ω—ã–π.

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—è–¥–æ–∫ $‚â§$ ‚Äî –Ω–µ –∏–Ω–≤–µ—Ä—Å–∏—è –ø–æ—Ä—è–¥–∫–∞ $‚™Ø$. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ–∑—å–º–µ–º –∞–ª—Ñ–∞–≤–∏—Ç
${A=\\{\texttt{A},\texttt{B}\\}}$ —Å ${\texttt{A} < \texttt{B}}$. –î–ª—è —Å—Ç—Ä–æ–∫ ${\tt ABB}$ –∏
${\tt ABBAA}$ –≤–µ—Ä–Ω—ã –æ–±–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞:
* ${\texttt{ABB} ‚â§ \texttt{ABBAA}}$
* ${\texttt{ABB} ‚™Ø \texttt{ABBAA}}$

–ë–æ–ª–µ–µ —Ç–æ–≥–æ, –≤ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ –ø–æ—Ä—è–¥–∫–æ–≤ $‚â§$ –∏ $‚™Ø$ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ —É—Å–ª–æ–≤–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞.
–¢.–µ.–æ–±–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è ${x ‚â§ y}$ –∏ ${x ‚™Ø y}$ –≤–µ—Ä–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ $x$ ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å $y$.

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Å—É—Ñ—Ñ–∏–∫—Å—ã —Å—Ç—Ä–æ–∫–∏ ${\tt ABAABAA}$, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø—Ä—è–º–æ–º –∏
–æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

```textinline
  –°—É—Ñ—Ñ–∏–∫—Å—ã        ‚â§                ‚™Ø
ABAABAA         A                BAA
BAABAA          AA               BAABAA
AABAA           AABAA            A
ABAA            ABAA             ABAA
BAA             ABAABAA          ABAABAA
AA              BAA              AA
A               BAABAA           AABAA
```

***–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å*** ‚Äî —ç—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–∞—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ —Å—Ç—Ä–æ–∫–∏ $x$ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º
–ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –ø–æ—Ä—è–¥–∫–æ–º. –û–±–æ–∑–Ω–∞—á–∏–º –µ–≥–æ —á–µ—Ä–µ–∑ ${Maxsuf(x)}$. –í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ
${Maxsuf(\tt ABAABAA)}$ —Ä–∞–≤–µ–Ω ${\tt BAABAA}$ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∏ ${\tt AABAA}$ –¥–ª—è
–æ–±—Ä–∞—Ç–Ω–æ–≥–æ.

__–¢–µ–æ—Ä–µ–º–∞__

–ü—É—Å—Ç—å $x$ ¬≠‚Äî –Ω–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–∑ —Å–∏–º–≤–æ–ª–æ–≤ –∞–ª—Ñ–∞–≤–∏—Ç–∞ $A$ –∏ ${x=uv=u\'v\'}$, –≥–¥–µ $v$ ¬≠‚Äî
–ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ $x$ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä—è–º—ã–º –ø–æ—Ä—è–¥–∫–æ–º ($‚â§$), –∞
$v\'$ ‚Äî –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å $x$ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –æ–±—Ä–∞—Ç–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º (‚™Ø).
–ï—Å–ª–∏ ${|v|‚â§|v\'|}$, —Ç–æ ${uv}$ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ $x$, –∞ –∏–Ω–∞—á–µ ${u\'v\'}$ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ
—Ä–∞–∑–±–∏–µ–Ω–∏–µ $x$. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, ${|u|<per(x)}$ –∏ ${|u\'|<per(x)}$.

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –¥–∞–Ω–æ –≤ [[1]](#reference_text_algorithms)

–ò–º–µ—è —ç—Ç—É —Ç–µ–æ—Ä–µ–º—É, –∑–∞–¥–∞—á–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è —Å–≤–æ–¥–∏—Ç—Å—è –∫ –∑–∞–¥–∞—á–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è
–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.

## –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ —Å—Ç—Ä–æ–∫–∏.

```kotlin
data class Factorization(
    val left: IntRange,
    val right: IntRange,
    val rightPeriod: Int
)

fun factorize(pattern: String): Factorization {
    val naturalOrder = computeMaxSuffixAndPeriod(pattern, naturalOrder())
    val reverseOrder = computeMaxSuffixAndPeriod(pattern, reverseOrder())
    return if (naturalOrder.right.length <= reverseOrder.right.length)
        naturalOrder else reverseOrder
}

fun computeMaxSuffixAndPeriod(pattern: String, 
                              comparator: Comparator<Char>): Factorization‚Ä¶
```
`computeMaxSuffixAndPeriod()` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã—á–∏—Å–ª—è—é—â–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å –∏ –ø–µ—Ä–∏–æ–¥ –ø—Ä–∞–≤–æ–π
–ø–æ–¥—Å—Ç—Ä–æ–∫–∏.

__–ü—Ä–∏–º–µ—Ä 1__

–®–∞–±–ª–æ–Ω ${pattern=\tt \underlinesegment{ABA}\underlinesegment{ABA}\underlinesegment{A\space\space\space}}$  
–ü–µ—Ä–∏–æ–¥ ${pattern}$: ${p=3}$  

| –ü–æ—Ä—è–¥–æ–∫ | –ú–∞–∫—Å. —Å—É—Ñ—Ñ–∏–∫—Å |  –†–∞–∑–±–∏–µ–Ω–∏–µ |
| - | - | - |
| –ü—Ä—è–º–æ–π $‚â§$ | ${\tt BAABAA}$ | ${(\texttt{A}, \texttt{BAABAA})}$ |
| –û–±—Ä–∞—Ç–Ω—ã–π $‚™Ø$ | ${\tt AABAA}$ | ${(\texttt{AB}, \texttt{AABAA})}$ | 

–†–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ, –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ = 2 (${\texttt{BA}}$).
–†–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ.

__–ü—Ä–∏–º–µ—Ä 2__

–®–∞–±–ª–æ–Ω ${pattern=\tt \underlinesegment{ABABAABB}\underlinesegment{ABABA\space\space\space\space}}$  
–ü–µ—Ä–∏–æ–¥ ${pattern}$: ${p=8}$  

| –ü–æ—Ä—è–¥–æ–∫ | –ú–∞–∫—Å. —Å—É—Ñ—Ñ–∏–∫—Å |  –†–∞–∑–±–∏–µ–Ω–∏–µ |
| - | - | - |
| –ü—Ä—è–º–æ–π $‚â§$ | ${\tt BBABABA}$ | ${(\texttt{ABABAA}, \texttt{BBABABA})}$ |
| –û–±—Ä–∞—Ç–Ω—ã–π $‚™Ø$ | ${\tt AABBABABA}$ | ${(\texttt{ABAB}, \texttt{AABBABABA})}$ | 

–û–±–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ.

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –õ–∏–Ω–¥–æ–Ω–∞.
–í–º–µ—Å—Ç–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–∞–∫–∂–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–∞–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ $v$.

```kotlin
fun computeMaxSuffixAndPeriod(pattern: String, comparator: Comparator<in Char>): Factorization {
    var maxSuffix = -1
    var j = 0
    var k = 1
    var period = 1
    while (j + k < pattern.length) {
        val a = pattern[j + k]
        val b = pattern[maxSuffix + k]
        val abOrder = comparator.compare(a, b)
        when {
            // a < b
            abOrder < 0 -> {
                j += k
                k = 1
                period = j - maxSuffix

            // a == b
            abOrder == 0 -> {
                if (k != period) {
                    k += 1
                } else {
                    j += period
                    k = 1
                }

            // a > b
            else ->  {
                maxSuffix = j
                j = maxSuffix + 1
                k = 1
                period = 1
            }
        }
    }
    return Factorization(0 .. maxSuffix,
        maxSuffix + 1 .. pattern.lastIndex,
        period
    )
}
```

–û–±–æ–∑–Ω–∞—á–∏–º —á–µ—Ä–µ–∑ ${Maxsuf(x)}$ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ $x$ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–º
–ø–æ—Ä—è–¥–∫–æ–º.

–ü—É—Å—Ç—å ${Maxsuf(x)=f^eg}$, –≥–¥–µ:  
$f$, $g$ ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–∫–∏  
${|f|=per(Maxsuf(x))}$ (–¥–ª–∏–Ω–∞ $f$ ‚Äî —ç—Ç–æ –ø–µ—Ä–∏–æ–¥ —Å—Ç—Ä–æ–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞)  
$g$ ‚Äî —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ $f$;  
$e$ ‚Äî —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ $e>0$.  
–í–≤–µ–¥–µ–º –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è: ${Per(x)=f; \space Rest(x)=g}$  
–û—Ç–º–µ—Ç–∏–º, —á—Ç–æ ${Rest(x)}$ ‚Äî —ç—Ç–æ –≥—Ä–∞–Ω—å —Å—Ç—Ä–æ–∫–∏ ${Maxsuf(x)}$ –∏ ${Border(Maxsuf(x))=f^{e-1}g}$, –¥–∞–∂–µ –ø—Ä–∏ ${e=1}$.

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `maxSuffix` –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ ‚Äî –ø–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º —Å–∏–º–≤–æ–ª–æ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–æ–π —Å—Ç—Ä–æ–∫–∏
–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞.  
`period` ‚Äî –ø–µ—Ä–∏–æ–¥ —Å—Ç—Ä–æ–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞, –¥–ª–∏–Ω–∞ ${Per(x)}$.  
`j` ‚Ä¶ `j+k` ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –≤ ${Maxsuf(x)}$ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω–æ–≥–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—è ${Rest(x)}$ –≤
–ø–æ–¥—Å—Ç—Ä–æ–∫–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É—Ñ—Ñ–∏–∫—Å–∞.

```goat
                   .-------------------------------------------------------------------.                               
                   |              Maxsuf(x)                                            |
                   '-------------------------------------------------------------------'
                   :
  .------------+---+----------+---+----------------------------------------------------+---+-------.
x |            |   |          | a'|                                         :          | a |       |
  '------------+---+----------+---+----------------------------------------------------+---+-------'
                ms :          :                                             :j         :j+k
                   :          :                                             :          :
                   .------------------.                  .------------------+----------.
                   |  Period(x)       |  ‚Ä¶  ‚Ä¶  ‚Ä¶   ‚Ä¶  ‚Ä¶  | Period(x)        | Rest(x)  |
                   '------------------'                  '------------------+----------'
                   :          :ms+k
                   .----------.
                   | Rest(x)  |
                   '----------'
```

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞ –≤—Ä–µ–º—è ${O(|pattern|)}$, –ø—Ä–∏ —ç—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–µ–Ω–µ–µ ${2*|pattern|}$
—Å—Ä–∞–≤–Ω–µ–Ω–∏–π.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ, –∫–∞–∫ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ $x$ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –µ—ë
–∫–æ–Ω–µ—Ü —Å–∏–º–≤–æ–ª–æ–≤ $\texttt{A}, \texttt{B}\text{ –∏ }\texttt{C}$.

–ü—É—Å—Ç—å ${x=\tt ABCBCBACBCBACBC}$. –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –µ—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å —Ä–∞–≤–µ–Ω
${Maxsuf(x)=\texttt{CBCBACBCBACBC}=(\texttt{CBCBA})¬≤\texttt{CBC}}$.  
–ú–∞–∫—Å. —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${x\texttt{A}}$: ${\tt CBCBACBCBACBCA}$ = ${Maxsuf(x)\texttt{A}}$. –°–ª–æ–≤–æ
–±–µ–∑ –≥—Ä–∞–Ω–∏—Ü.  
–ú–∞–∫—Å. —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${x\texttt{B}}$: ${\tt CBCBACBCBACBCB}$ = ${Maxsuf(x)\texttt{B}}$. –£
—Å—Ç—Ä–æ–∫–∏ —Ç–∞–∫–æ–π –∂–µ –ø–µ—Ä–∏–æ–¥, –∫–∞–∫ –∏ —É ${Maxsuf(x)}$.  
–ú–∞–∫—Å. —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${x\texttt{C}}$: ${\tt CC}$.

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –ª–µ–º–º–µ.  

__–õ–µ–º–º–∞__  

:   –í–æ–∑—å–º–µ–º —Å—Ç—Ä–æ–∫—É $x$, —Å–∏–º–≤–æ–ª $\tt A$ –∏ —Å–∏–º–≤–æ–ª ${\texttt{A'}}$ —Ç–∞–∫–æ–π, —á—Ç–æ
    ${Rest(x)\texttt{A'}}$ ‚Äî —ç—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å ${Maxsuf(x)}$. –¢–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è
    ${Maxsuf(x\texttt{A}), Per(x\texttt{A}), Rest(x\texttt{A})}$ –±—É–¥—É—Ç —Ä–∞–≤–Ω—ã —Å–ª–µ–¥—É—é—â–∏–º:

    | __–£—Å–ª–æ–≤–∏–µ__ | $\bf Maxsuf(x\texttt{A})$ | $\bf Per(x\texttt{A})$ | $\bf Rest(x\texttt{A})$ |
    | - | - | - | - |
    | ${\texttt{A} < \texttt{A'}}$ | ${Maxsuf(x)\texttt{A}}$ | ${Maxsuf(x)\texttt{A}}$ | $Œµ$ |
    | ${\texttt{A} = \texttt{A'}}$ | ${Maxsuf(x)\texttt{A}}$ | ${Per(x)}$ | ${Rest(x)\texttt{A}}$, –ª–∏–±–æ $Œµ$ |
    | ${\texttt{A} > \texttt{A'}}$ | ${Maxsuf(Rest(x)\texttt{A})}$ | ${Per(Rest(x)\texttt{A})}$ | ${Rest(Rest(x)\texttt{A})}$ |

    –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –¥–∞–Ω–æ –≤ [[1]](#reference_text_algorithms).

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ (–Ω–∞ Kotlin, –±–µ–∑ —É—á–µ—Ç–∞ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã—Ö –ø–∞—Ä).

```kotlin
internal data class Factorization(
    val pattern: String,
    val left: IntRange,
    val right: IntRange,
    val rightPeriod: Int
) {
    fun leftIsSuffixOfRight(): Boolean {
        return left.all {
            i -> pattern[i] == pattern[right.first + rightPeriod - left.length + i]
        }
    }
}

fun findSubstringTwoWay(text: String, pattern: String): List<Int> {
    when {
        text.isEmpty() -> return emptyList()
        pattern.isEmpty() -> return text.indices.toList()
    }

    val result: MutableList<Int> = mutableListOf()

    val factorization = factorize(pattern)
    if (factorization.leftIsSuffixOfRight()) {
        // CP1
        val (_, left, right, period) = factorization
        var pos = 0
        var memPrefix = -1
        while (pos + pattern.length <= text.length) {
            // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
            val i = (maxOf(right.first, memPrefix + 1)..right.last).find { i ->
                pattern[i] != text[pos + i]
            }
            if (i != null) {
                pos = pos + i - right.first + 1
                memPrefix = -1
            } else {
                // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
                val match = (left.last downTo memPrefix + 1).all { j ->
                    pattern[j] == text[pos + j]
                }
                if (match) result.add(pos)
                pos += period
                memPrefix = pattern.length - period - 1
            }
        }
    } else {
        // CP2
        val left = factorization.left.reversed()
        val right = factorization.right
        val q = maxOf(left.length, right.length) + 1
        var pos = 0
        while (pos + pattern.length <= text.length) {
            // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
            val i = right.find { i -> pattern[i] != text[pos + i] }
            if (i != null) {
                pos = pos + i - right.first + 1
            } else {
                // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏
                val match = left.all { j -> pattern[j] == text[pos + j] }
                if (match) result.add(pos)
                pos += q
            }
        }
    }
    return result
}

private fun factorize(pattern: String): Factorization {
    val naturalOrder = computeMaxSuffixAndPeriod(pattern, naturalOrder())
    val reverseOrder = computeMaxSuffixAndPeriod(pattern, reverseOrder())
    return if (naturalOrder.right.length <= reverseOrder.right.length)
        naturalOrder else reverseOrder
}

internal fun computeMaxSuffixAndPeriod(pattern: String,
                                       comparator: Comparator<in Char>): Factorization {
    var maxSuffix = -1
    var j = 0
    var k = 1
    var period = 1
    while (j + k < pattern.length) {
        val a = pattern[j + k]
        val b = pattern[maxSuffix + k]
        val abOrder = comparator.compare(a, b)
        when {
            // a < b
            abOrder < 0 -> {
                j += k
                k = 1
                period = j - maxSuffix
            }

            // a == b
            abOrder == 0 -> {
                if (k != period) {
                    k += 1
                } else {
                    j += period
                    k = 1
                }
            }

            // a > b
            else -> {
                maxSuffix = j
                j = maxSuffix + 1
                k = 1
                period = 1
            }
        }
    }
    return Factorization(
        pattern,
        0..maxSuffix,
        maxSuffix + 1..pattern.lastIndex,
        period
    )
}
```

–û–Ω–∞ –∂–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: [twoway.kt].

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏

<ol>
{{< li_id "reference_text_algorithms" >}}
CROCHEMORE, M., RYTTER, W., 1994, Text Algorithms, Oxford University Press. ([—Å—Å—ã–ª–∫–∞](https://www-igm.univ-mlv.fr/~mac/REC/B1.html))
{{< /li_id >}}
{{<li_id "reference_twoway_string_matching" >}}
CROCHEMORE M., PERRIN D., 1991, Two-way string-matching, Journal of the ACM 38(3):651-675. ([—Å—Å—ã–ª–∫–∞](https://monge.univ-mlv.fr/~mac/Articles-PDF/CP-1991-jacm.pdf))
{{< /li_id >}}
{{<li_id "reference_twoway_wikipedia" >}}
Wikipedia: Two-way string-matching algorithm ([—Å—Å—ã–ª–∫–∞](https://en.wikipedia.org/wiki/Two-way_string-matching_algorithm)).
{{< /li_id >}}
{{<li_id "reference_twoway_itmo" >}}
–í–∏–∫–∏–∫–æ–Ω—Å–ø–µ–∫—Ç—ã –ò–¢–ú–û: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º ([—Å—Å—ã–ª–∫–∞](https://neerc.ifmo.ru/wiki/index.php?title=%D0%94%D0%B2%D1%83%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%BD%D0%B8%D0%B9_%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC)).
{{< /li_id >}}
{{<li_id "reference_kutelin_clickhouse" >}}
–ö—É—Ç–µ–Ω–∏–Ω –î–∞–Ω–∏–ª–∞ –ú., 2019. –£–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–æ–∫ –≤ ClickHouse ([—Å—Å—ã–ª–∫–∞](https://www.hse.ru/edu/vkr/296308510))
{{< /li_id >}}
{{<li_id "reference_galil_seiferas" >}}
Galil-Seiferas algorithm ([—Å—Å—ã–ª–∫–∞](http://www-igm.univ-mlv.fr/~lecroq/string/node25.html#SECTION00250))
{{< /li_id >}}
</ol>

[twoway.kt]: {{< param BookRepo >}}/blob/main/code/src/main/kotlin/substring/TwoWay.kt

[glibc]: https://github.com/bminor/glibc/blob/a01a13601c95f5d111d25557656d09fe661cfc89/string/strstr.c#L74
[newlib]: https://sourceware.org/git/?p=newlib-cygwin.git;a=blob;f=newlib/libc/string/memmem.c;h=65267b9c5e52b15db86feec5b7a511d927ec469a;hb=HEAD#l112
[musl]: https://git.musl-libc.org/cgit/musl/tree/src/string/strstr.c#n33
